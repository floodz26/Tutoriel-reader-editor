<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Import Calculateur</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .example {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Import Calculateur LibreOffice</h1>

    <div class="example">
        <h3>üìã Exemple de donn√©es √† copier depuis LibreOffice Calc :</h3>
        <p>Dans LibreOffice Calc, cr√©ez un tableau comme ceci :</p>
        <table border="1" cellpadding="5">
            <tr>
                <th>A: Label</th>
                <th>B: Valeur</th>
                <th>C: Unit√©</th>
                <th>D: Min</th>
                <th>E: Max</th>
                <th>F: Step</th>
            </tr>
            <tr>
                <td>Diam√®tre de la yourte</td>
                <td>6</td>
                <td>m</td>
                <td>4</td>
                <td>10</td>
                <td>0.5</td>
            </tr>
            <tr>
                <td>Marge de s√©curit√©</td>
                <td>0.3</td>
                <td>m</td>
                <td>0.1</td>
                <td>0.5</td>
                <td>0.1</td>
            </tr>
            <tr>
                <td>Diam√®tre de la plateforme</td>
                <td>=B2+B3</td>
                <td>m</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>Surface</td>
                <td>=PI()*(B4/2)^2</td>
                <td>m¬≤</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
        <p><strong>Puis s√©lectionnez toutes les cellules et faites Ctrl+C</strong></p>
    </div>

    <h3>Collez vos donn√©es ici (format TSV) :</h3>
    <textarea id="tsvInput" placeholder="Label	Valeur	Unit√©	Min	Max	Step
Diam√®tre de la yourte	6	m	4	10	0.5
Marge de s√©curit√©	0.3	m	0.1	0.5	0.1
Diam√®tre de la plateforme	=B2+B3	m
Surface	=PI()*(B4/2)^2	m¬≤"></textarea>

    <div>
        <label>Nom du calculateur : <input type="text" id="calcName" value="Calcul de dimensions" style="width: 300px;"></label>
    </div>
    <div style="margin-top: 10px;">
        <label>Description : <input type="text" id="calcDesc" value="Calculez les dimensions n√©cessaires" style="width: 500px;"></label>
    </div>

    <button onclick="testImport()">üöÄ Importer et convertir</button>

    <div id="results"></div>

    <script src="calculator-import.js"></script>
    <script>
        function testImport() {
            const tsvData = document.getElementById('tsvInput').value;
            const name = document.getElementById('calcName').value;
            const description = document.getElementById('calcDesc').value;
            const resultsDiv = document.getElementById('results');

            if (!tsvData.trim()) {
                resultsDiv.innerHTML = '<div class="error">‚ùå Veuillez coller des donn√©es TSV</div>';
                return;
            }

            try {
                const importer = new CalculatorImporter();
                const calculator = importer.importFromSpreadsheet(tsvData, name, description);

                // Validation
                const validation = importer.validate(calculator);

                let html = '';

                if (!validation.valid) {
                    html += '<div class="error"><h4>‚ùå Erreurs de validation :</h4><ul>';
                    validation.errors.forEach(err => {
                        html += `<li>${err}</li>`;
                    });
                    html += '</ul></div>';
                } else {
                    html += '<div class="success">‚úÖ Import r√©ussi !</div>';
                }

                html += '<div class="result">';
                html += '<h4>üìä R√©sultat de l\'import :</h4>';
                html += `<p><strong>Nom :</strong> ${calculator.name}</p>`;
                html += `<p><strong>Description :</strong> ${calculator.description}</p>`;
                html += `<p><strong>Nombre de cellules :</strong> ${calculator.cells.length}</p>`;

                html += '<h5>Cellules :</h5><ul>';
                calculator.cells.forEach(cell => {
                    if (cell.type === 'input') {
                        html += `<li>üìù <strong>${cell.label}</strong> : ${cell.value} ${cell.unit} (min: ${cell.min}, max: ${cell.max}, step: ${cell.step})</li>`;
                    } else {
                        html += `<li>üßÆ <strong>${cell.label}</strong> : <code>${cell.formula}</code> ${cell.unit}</li>`;
                    }
                });
                html += '</ul></div>';

                html += '<div class="result">';
                html += '<h4>üíæ JSON g√©n√©r√© :</h4>';
                html += '<pre>' + JSON.stringify(calculator, null, 2) + '</pre>';
                html += '</div>';

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error"><h4>‚ùå Erreur :</h4><p>${error.message}</p><pre>${error.stack}</pre></div>`;
            }
        }

        // Exemple pr√©-rempli au chargement
        window.addEventListener('load', () => {
            // Pr√©-remplir avec l'exemple
            const exampleData = `Label\tValeur\tUnit√©\tMin\tMax\tStep
Diam√®tre de la yourte\t6\tm\t4\t10\t0.5
Marge de s√©curit√©\t0.3\tm\t0.1\t0.5\t0.1
Diam√®tre de la plateforme\t=B2+B3\tm
Rayon\t=B4/2\tm
Surface de la plateforme\t=PI()*B5^2\tm¬≤
P√©rim√®tre\t=PI()*B4\tm
Nombre de boulons M10\t=CEIL(B7/0.5)*2\tunit√©s`;

            document.getElementById('tsvInput').value = exampleData;
            testImport();
        });
    </script>
</body>
</html>
